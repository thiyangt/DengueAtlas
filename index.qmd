---
title: "Sri Lanka Dengue Atlas"
---

## History matters: **What was happening this time last year?**

### **Sri Lanka Dengue \| Week 1–Week 8, 2025**

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(here)
library(leaflet)
library(sf)
library(sp)
library(readxl)
library(readr)
library(tidyverse)
library(viridis)
DengueAtlas1 <- read_excel("dataraw/DengueAtlas.xlsx", sheet=1)
DengueAtlas2 <- read_excel("dataraw/DengueAtlas.xlsx", sheet=2)
df <- read_csv("dataraw/df.csv")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
merged_df <- DengueAtlas1 |>
  dplyr::left_join(df, by = "HighRiskMOHAreas")

# View result
#head(merged_df)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.cap="Figure 1: Aggregated dengue cases by MOH area in Sri Lanka for 2025: Week 1 to Week 8. Circle size represents the total number of cases in each area, and color indicates case intensity grouped into categories: 0–100, 101–200, 201–400, 401–600, 601–800, and 801–1000. Hover over each circle to view the exact count for the MOH area."}
# Aggregate dengue counts by MOH area
df_agg <- merged_df  |>
  group_by(HighRiskMOHAreas, Longitude, Latitude)|>
  summarise(TotalCases = sum(Cases), .groups = "drop")
df_agg <- df_agg |>
  mutate(Longitude = as.numeric(Longitude),
         Latitude = as.numeric(Latitude))


# Define color palette based on cases
# Define bins and color palette
bins <- c(1, 100, 200, 400, 600, 800, 1000)  # your categories
pal <- colorBin(
  palette = viridis(6),  
  domain = df_agg$TotalCases,
  bins = bins,
  na.color = "grey"
)

# Leaflet map
leaflet(df_agg) %>%
  addTiles() %>%
  addCircleMarkers(
    ~Longitude, ~Latitude,
    radius = ~sqrt(TotalCases),  # size proportional to cases
    color = ~pal(TotalCases),
    stroke = TRUE,
    fillOpacity = 0.7,
    label = ~paste0(HighRiskMOHAreas, ": ", TotalCases, " cases")
  ) %>%
  addLegend(
    "bottomright",
    pal = pal,
    values = ~TotalCases,
    title = "Dengue Cases",
    opacity = 1,
    labFormat = labelFormat(suffix = " cases")
  )
```


