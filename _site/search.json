[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Sri Lanka Dengue Atlas",
    "section": "",
    "text": "library(dplyr)\nlibrary(sf)\nlibrary(lubridate)\nlibrary(scales)\nlibrary(denguedatahub)\nlibrary(htmlwidgets)\nlibrary(crosstalk)\nlibrary(ceylon)\n\n\nsrilanka_weekly_data &lt;- srilanka_weekly_data %&gt;%\n  mutate(\n    start.date = as.Date(start.date, format = \"%m/%d/%Y\"),\n    end.date   = as.Date(end.date,   format = \"%m/%d/%Y\")\n  )\n\n\nfilter_by_date &lt;- function(data, from_date, to_date) {\n  data %&gt;%\n    filter(\n      start.date &lt;= to_date,\n      end.date   &gt;= from_date\n    )\n}\n\n\naggregate_district_cases &lt;- function(data) {\n  data %&gt;%\n    group_by(district) %&gt;%\n    summarise(\n      cases = sum(cases, na.rm = TRUE),\n      .groups = \"drop\"\n    )\n}\n\n\ndata(district)\nsl_districts &lt;-  district %&gt;%\n  st_transform(4326) \n\n\nmake_map_data &lt;- function(from_date, to_date) {\n\n  dengue_filtered &lt;- srilanka_weekly_data %&gt;%\n    filter_by_date(from_date, to_date) %&gt;%\n    aggregate_district_cases()\n\n # sl_districts %&gt;%\n #   left_join(dengue_filtered, by = \"district\") %&gt;%\n #   mutate(cases = replace_na(cases, 0))\n  \n  dengue_filtered &lt;- dengue_filtered %&gt;%\n  mutate(district = toupper(district))\n\n  sl_districts &lt;- sl_districts %&gt;%\n  mutate(DISTRICT = toupper(DISTRICT))\n  \n  sl_map_data &lt;- sl_districts %&gt;%\n  left_join(dengue_filtered, by = c(\"DISTRICT\" = \"district\")) #%&gt;%\n#  mutate(cases = replace_na(cases, 0))\n\n}\n\n\nmap_data &lt;- make_map_data(\n  from_date = as.Date(\"2019-01-01\"),\n  to_date   = as.Date(\"2019-12-31\")\n)\n\nmap_data\n\nSimple feature collection with 26 features and 4 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 79.51916 ymin: 5.918297 xmax: 81.8772 ymax: 9.835718\nGeodetic CRS:  WGS 84\n# A tibble: 26 × 5\n                                       geometry DISTRICT Status population cases\n                             &lt;MULTIPOLYGON [°]&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt;\n 1 (((79.80303 7.8503, 79.80333 7.849463, 79.8… [UNKNOW… &lt;NA&gt;           NA    NA\n 2 (((81.23892 7.738495, 81.23903 7.73846, 81.… AMPARA   Distr…     736000   378\n 3 (((80.79126 8.918771, 80.79164 8.918763, 80… ANURADH… Distr…     943000  1003\n 4 (((80.9806 7.61768, 80.98104 7.617651, 80.9… BADULLA  Distr…     886000  1900\n 5 (((81.76936 7.536074, 81.76918 7.536048, 81… BATTICA… Distr…     579000  2751\n 6 (((79.87696 6.98085, 79.87805 6.98068, 79.8… COLOMBO  Distr…    2455000 20604\n 7 (((80.09646 6.132867, 80.09638 6.132866, 80… GALLE    Distr…    1135000  6363\n 8 (((80.14677 7.312115, 80.14689 7.311824, 80… GAMPAHA  Distr…    2423000 13809\n 9 (((81.61401 6.572167, 81.61425 6.572167, 81… HAMBANT… Distr…     668000    NA\n10 (((79.52615 9.383134, 79.52537 9.383026, 79… JAFFNA   Distr…     621000  8260\n# ℹ 16 more rows\n\n\n\nlibrary(ggplot2)\n\nggplot(map_data) +\n  geom_sf(\n    aes(fill = cases),\n    color = \"white\",\n    linewidth = 0.2\n  ) +\n#  scale_fill_brewer(\n #   palette = \"YlOrRd\",\n #   na.value = \"grey90\",\n#    name = \"Annual dengue cases\"\n#  ) +\n  labs(\n    title = \"Annual Dengue Cases by District\",\n    subtitle = \"Sri Lanka\",\n    caption = \"Source: Dengue surveillance data\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    panel.grid = element_blank(),\n    axis.text  = element_blank(),\n    axis.title = element_blank(),\n    legend.position = \"right\"\n  )"
  }
]